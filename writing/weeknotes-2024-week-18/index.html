<!doctype html><html lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>Weeknotes (2024 week 18) - Matthias Kestenholz</title><link href=/styles.7a4c5338b9f2.css rel=stylesheet><link title="Blog feed" href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=title href=/>Hi, I'm Matthias</a><p class=subtitle>I am a founding partner of <a href=https://feinheit.ch>Feinheit AG</a> and <a href=https://diebruchpiloten.com>Die Bruchpiloten AG</a>. Find me on <a href=https://github.com/matthiask/>GitHub</a>, <a href=https://hachyderm.io/@matthiask rel=me>Mastodon</a>, <a href=https://bsky.app/profile/matthiask.406.ch rel=me>Bluesky</a>, <a rel="noopener noreferrer" title="if you must" href=https://www.linkedin.com/in/matthiaskestenholz target=_blank>LinkedIn</a> or by <a href=mailto:mk@406.ch>email</a>.<nav><a href=/writing/category-climate/>Climate</a><a href=/writing/category-django/>Django</a><a href=/writing/category-feincms/>feincms</a><a href=/writing/category-politik/>Politik</a><a href=/writing/category-programming/>Programming</a><a href=/writing/category-python/>Python</a><a href=/writing/category-til/>TIL</a><a href=/writing/category-weeknotes/>Weeknotes</a></nav></div></header><main><div class=wrappy><div class=text><small>2024-05-03 </small><h1 id=weeknotes-2024-week-18><a class=toclink href=#weeknotes-2024-week-18>Weeknotes (2024 week 18)</a></h1><h2 id=google-summer-of-code-has-begun><a class=toclink href=#google-summer-of-code-has-begun>Google Summer of Code has begun</a></h2><p>We have a student helping out with adding async support to the <a href=https://github.com/jazzband/django-debug-toolbar/>Django Debug Toolbar</a>. It’s great that someone can spend some concentrated time to work on this. Tim and others have done all the necessary preparation work, I’m only helping from the sidelines so don’t thank me.<h2 id=bike-to-work><a class=toclink href=#bike-to-work>Bike to Work</a></h2><p>Two teams from my company are participating in the <a href=https://www.biketowork.ch/>Bike to Work Challenge 2024</a>. It’s what I do anyway (if I’m not working from home) but maybe it helps build others some motivation to get on the bicycle once more. Public transports in the city where I live are great but I’ll always take the bike when I can. I also went on my first mountain bike ride in a few months yesterday, good fun.<h2 id=json-blobs-and-referential-integrity><a class=toclink href=#json-blobs-and-referential-integrity>JSON blobs and referential integrity</a></h2><p>The <a href=https://github.com/matthiask/django-json-schema-editor/>django-json-schema-editor</a> has gained support for referencing Django models. Here’s an example schema excerpt:<div class=chl><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=o>...</span>
<span class=w>    </span><span class=s>"articles"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=s>"type"</span><span class=p>:</span><span class=w> </span><span class=s>"array"</span><span class=p>,</span>
<span class=w>        </span><span class=s>"format"</span><span class=p>:</span><span class=w> </span><span class=s>"table"</span><span class=p>,</span>
<span class=w>        </span><span class=s>"title"</span><span class=p>:</span><span class=w> </span><span class=nx>_</span><span class=p>(</span><span class=s>"articles"</span><span class=p>),</span>
<span class=w>        </span><span class=s>"minItems"</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>        </span><span class=s>"maxItems"</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<span class=w>        </span><span class=s>"items"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=s>"type"</span><span class=p>:</span><span class=w> </span><span class=s>"string"</span><span class=p>,</span>
<span class=w>            </span><span class=s>"title"</span><span class=p>:</span><span class=w> </span><span class=nx>_</span><span class=p>(</span><span class=s>"article"</span><span class=p>),</span>
<span class=w>            </span><span class=s>"format"</span><span class=p>:</span><span class=w> </span><span class=s>"foreign_key"</span><span class=p>,</span>
<span class=w>            </span><span class=s>"options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=s>"url"</span><span class=p>:</span><span class=w> </span><span class=s>"/admin/articles/article/?_popup=1&_to_field=id"</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=o>...</span>
<span class=p>}</span>
</code></pre></div><p>The ID field is stringly typed; using an integer directly wouldn’t work because the empty string isn’t a valid integer.<p>The problem with referencing models in this way is that there’s no way to know if the referenced object is still around or not, or even to protect it against deletion. The bundled django-content-editor <code>JSONPlugin</code> now supports automatically generating a <code>ManyToManyField</code> with a <code>through</code> model which protects articles from deletion as long as they are referenced from a <code>JSONPlugin</code> instance. The <code>register_reference</code> line creates the mentioned model with an <code>on_delete=models.PROTECT</code> foreign key to articles and a <code>post_save</code> handler which updates said references.<div class=chl><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>django_json_schema_editor.plugins</span><span class=w> </span><span class=kn>import</span> <span class=n>JSONPluginBase</span><span class=p>,</span> <span class=n>register_reference</span>
<span class=kn>from</span><span class=w> </span><span class=nn>articles.models</span><span class=w> </span><span class=kn>import</span> <span class=n>Article</span>

<span class=k>class</span><span class=w> </span><span class=nc>JSONPlugin</span><span class=p>(</span><span class=n>JSONPluginBase</span><span class=p>,</span> <span class=o>...</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=n>register_reference</span><span class=p>(</span><span class=n>JSONPlugin</span><span class=p>,</span> <span class=s2>"articles"</span><span class=p>,</span> <span class=n>Article</span><span class=p>)</span>
</code></pre></div><h2 id=releases-since-the-beginning-of-april><a class=toclink href=#releases-since-the-beginning-of-april>Releases since the beginning of April</a></h2><ul><li><a href=https://pypi.org/project/django-json-schema-editor/>django-json-schema-editor 0.0.14</a>: See above. Also, some styling work and a patch update to the vendorized json-editor.<li><a href=https://pypi.org/project/django-content-editor/>django-content-editor 6.4.6</a>: Many small stylistic fixes. The target indicator when dragging plugins is now also shown when plugins are collapsed. It’s now possible to directly drag a plugin to the end, and not just to the second to last position.<li><a href=https://pypi.org/project/django-prose-editor/>django-prose-editor 0.3.4</a>: Switched to the nh3 sanitizer because it’s faster and because ProseMirror never emits HTML which has to be cleaned up first. Stopped generating menu items for nodes and marks which aren’t in the schema. Added the possibility to reduce the functionality per editor instance. Small tweaks and fixes.<li><a href=https://pypi.org/project/django-tree-queries/>django-tree-queries 0.19</a>: Added support for pre-filtering the tree (much more efficient when only querying a part of the tree). Added support for adding additional fields to the CTE so that you can collect values from ancestors for other fields than the default fields too.<li><a href=https://pypi.org/project/FeinCMS/>FeinCMS 24.4.2</a>: Added support for webp images. Fixed a few of the admin list filters to work with Django 5.<li><a href=https://pypi.org/project/django-cabinet/>django-cabinet 0.14.3</a>: Fixed the support for the <code>extra_context</code> argument to our <code>changelist_view</code> implementation.</ul></div><div class="text prevnext"><a href=/writing/weeknotes-2024-week-21/>Previous post</a><a href=/writing/workbench-the-django-based-agency-software/>Next post</a></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Weeknotes (2024 week 18)">Send me an email.</a> <br> <a rel="noopener noreferrer" href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2024-05-03 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a>, <a href=/writing/category-weeknotes/>Weeknotes</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-dark></script></div></footer>