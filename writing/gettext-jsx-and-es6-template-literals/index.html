<!doctypehtml><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>gettext, JSX and ES6 template literals - Matthias Kestenholz</title><link href=/styles.b8b7ef2015d8092526f2f18dad22a94a.css rel=stylesheet><link title="Blog feed"href=/writing/feed/ rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><h1>gettext, JSX and ES6 template literals</h1><p>I really like using <a href=https://www.gnu.org/software/gettext/>gettext</a> to translate hardcoded strings into other languages. <a href=https://docs.djangoproject.com/en/3.1/topics/i18n/translation/>Django’s translations functionality</a> relies on it as well.<p>Unfortunately, the xgettext executable which is responsible to collect translatable strings in your code has a bug where it just stops processing files when encountering ES6 template literals inside JSX tags. Support for ES6 template literals was added <a href=https://savannah.gnu.org/bugs/?50920>earlier this year</a> but combining those literals with JSX <a href=https://savannah.gnu.org/bugs/?58407>still doesn’t work</a>.<p>I wrote a small Python script to extract <code>*gettext</code> calls from JavaScript files; the current version is <a href=https://github.com/matthiask/workbench/blob/main/extract_gettext.py>here</a>. The idea is to find all JavaScript files using <code>git ls-files "*.js"</code>, using a regular expression to find <code>*gettext</code> calls and write the output to a place where Django’s <code>./manage.py makemessages</code> finds it.<p>I’m certain the code will break too with strange error messages in the near future but it seems to work well, for the moment.<p>Here’s the current version of the code (hopefully) for your enjoyment:<pre><code>#!/usr/bin/env python3

import re
import subprocess


def js_files():
    res = subprocess.run(
        ["git", "ls-files", "*js", "*mjs"],
        capture_output=True,
        encoding="utf-8",
    )
    return res.stdout.splitlines()


def gettext_calls(file):
    with open(file, encoding="utf-8") as f:
        return [
            f"{match[0]}({match[1]})"
            for match in re.findall(
                r"""\b(\w*gettext)\(\s*((['"]).+?\3)\s*\)""",
                f.read(),
            )
        ]


if __name__ == "__main__":
    calls = []
    for file in js_files():
        calls.extend(gettext_calls(file))
    print("\n".join(sorted(set(calls))))
</code></pre></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=gettext, JSX and ES6 template literals">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2020-10-21 in <a href=/writing/category-django//>Django</a>, <a href=/writing/category-programming//>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-dark></script></div></footer>