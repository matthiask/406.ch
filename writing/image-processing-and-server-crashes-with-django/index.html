<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Image processing and server crashes with Django - Matthias Kestenholz</title><link href=/styles.563d7bc18255.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><h1>Image processing and server crashes with Django</h1><p>The default <a href=https://docs.djangoproject.com/en/3.1/ref/models/fields/#imagefield>ImageField</a> model and form fields do not verify that <a href=https://pillow.readthedocs.io/en/stable/>Pillow</a> is able to actually process the image file at all. They only verify the image files’ headers. This is by design, since processing full images opens websites up to denial of service attacks.<p>The downside of this is that thumbnailing libraries have to guard against all sorts of invalid images. If they do not do this thoroughly an invalid (e.g. truncated) image file may crash a whole website. The worst which can happen (and this has happened to me a few times) is that it may even be impossible to replace the invalid image through the administration panel, because the customized admin widget <em>also</em> crashes while generating a thumbnail. Now you need a programmer with access to the database to even be able to replace the image. And maybe the website editors upload the invalid image again…<p>Anyway, these experiences lead me to repeatedly researching solutions and in the end, in the spirit of the following <a href=https://xkcd.com/927/>XKCD comic</a> I set out to write my own image field.<p><img alt="XKCD Standards"src=https://imgs.xkcd.com/comics/standards.png><p>The result of this work is <strong><a href=https://github.com/matthiask/django-imagefield>django-imagefield</a></strong>, first published in March 2018. It has the following differentiating features:<ul><li>In-depth validation of images. It does not matter whether the images are uploaded through forms or assigned directly to the model instances. You should always get errors when an image isn’t processable by Pillow later.<li>Django system check errors when forgetting the width and height field. Django allows you to omit width and height caching fields from models, but when you do this, images are always accessed even when instantiating querysets. This is bad(tm) for performance.<li>Ability to define processing pipelines, where thumbnails etc. are created eagerly instead of on-demand.</ul></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Image processing and server crashes with Django">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2020-09-12 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>