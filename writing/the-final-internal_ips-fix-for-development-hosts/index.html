<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>The final INTERNAL_IPS fix for development hosts - Matthias Kestenholz</title><link href=/styles.911896db6f8c.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><small>2018-04-20 </small><h1>The final INTERNAL_IPS fix for development hosts</h1><p>Django’s <a href=https://docs.djangoproject.com/en/2.0/ref/settings/#internal-ips>INTERNAL_IPS</a> setting is an ongoing source of frustration and confusion (not only, but also) for users of <a href=https://github.com/jazzband/django-debug-toolbar>django-debug-toolbar</a>, especially when using non-local addresses. This is very useful for testing a website using mobile devices if you do not have a very fast internet connection where it does not matter whether you connect to a host through the local network or via the internet, for example using <a href=https://localtunnel.github.io/www/>localtunnel</a>.<p>For some time we had a utility function which automatically added all detected network interface IPs to <code>INTERNAL_IPS</code>. However, this does not work when using virtualization software such as Docker or Vagrant with port forwarding, because the VM’s (or container’s) IP isn’t what you want – you want the host IP.<p>Once I took a step back I saw a different, but much simpler solution. <code>INTERNAL_IPS</code> can be replaced with an object which simply answers <code>True</code> to all <code>__contains__</code>-type questions:<div class=chl><pre><span></span><code><span class=k>if</span><span class=w> </span><span class=n>DEBUG</span><span class=o>:</span>
<span class=w>    </span><span class=c1># `debug` is only True in templates if the vistor IP is in INTERNAL_IPS.</span>
<span class=w>    </span><span class=n>INTERNAL_IPS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>type</span><span class=p>(</span><span class=n>str</span><span class=p>(</span><span class=s1>'c'</span><span class=p>),</span><span class=w> </span><span class=p>(),</span><span class=w> </span><span class=err>{</span><span class=s1>'__contains__'</span><span class=o>:</span><span class=w> </span><span class=n>lambda</span><span class=w> </span><span class=o>*</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=no>True</span><span class=err>}</span><span class=p>)()</span>
</code></pre></div></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=The final INTERNAL_IPS fix for development hosts">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2018-04-20 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>