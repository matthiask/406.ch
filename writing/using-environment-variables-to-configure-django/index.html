<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Using environment variables to configure Django - Matthias Kestenholz</title><link href=/styles.563d7bc18255.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><small>2020-09-13 </small><h1>Using environment variables to configure Django</h1><p>My preferred way to read values from the environment uses the <a href=https://docs.python.org/3/library/ast.html>ast</a> module to evaluate Python literals. This means that values such as <code>["*"]</code>, <code>None</code> and <code>True</code> aren’t returned as strings but actually have the expected type already.<p>A basic implementation using <code>ast.literal_eval()</code> follows:<div class=codehilite><pre><span></span><code><span class=kn>import</span> <span class=nn>ast</span>
<span class=kn>import</span> <span class=nn>os</span>

<span class=k>def</span> <span class=nf>env</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
    <span class=n>value</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>ast</span><span class=o>.</span><span class=n>literal_eval</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
    <span class=k>except</span> <span class=p>(</span><span class=ne>SyntaxError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>value</span>
</code></pre></div><p>Some deployment environments may not make it easy to add environment variables. I like placing a <code>.env</code> file into the project root containing additional key-value combinations. Here’s a way to add those values to the environment:<div class=codehilite><pre><span></span><code><span class=nv>def</span> <span class=nv>read_speckenv</span><span class=ss>()</span>:
    <span class=nv>with</span> <span class=nv>open</span><span class=ss>(</span><span class=s2>"</span><span class=s>.env</span><span class=s2>"</span><span class=ss>)</span> <span class=nv>as</span> <span class=nv>f</span>:
        <span class=k>for</span> <span class=nv>line</span> <span class=nv>in</span> <span class=nv>f</span>:
            <span class=nv>line</span> <span class=o>=</span> <span class=nv>line</span>.<span class=nv>strip</span><span class=ss>()</span>
            <span class=k>if</span> <span class=nv>not</span> <span class=nv>line</span> <span class=nv>or</span> <span class=nv>line</span>.<span class=nv>startswith</span><span class=ss>(</span><span class=s2>"</span><span class=s>#</span><span class=s2>"</span><span class=ss>)</span> <span class=nv>or</span> <span class=s2>"</span><span class=s>=</span><span class=s2>"</span> <span class=nv>not</span> <span class=nv>in</span> <span class=nv>line</span>:
                <span class=k>continue</span>
            <span class=nv>key</span>, <span class=nv>value</span> <span class=o>=</span> [<span class=nv>v</span>.<span class=nv>strip</span><span class=ss>(</span><span class=s2>"</span><span class=s>'\</span><span class=s2>"</span> \<span class=nv>t</span><span class=s2>"</span><span class=s>) for v in line.split(</span><span class=s2>"</span><span class=o>=</span><span class=s2>"</span><span class=s>, 1)]</span>
            <span class=nv>os</span>.<span class=nv>environ</span>.<span class=nv>setdefault</span><span class=ss>(</span><span class=nv>key</span>, <span class=nv>value</span><span class=ss>)</span>
</code></pre></div><p>Those two functions along with a few additional bells and whistles are available as <strong><a href=https://pypi.org/project/speckenv/><code>speckenv</code></a></strong> from PyPI. The packaged version also supports defaults, warning messages, coercion and using another mapping instead of <code>os.environ</code>. <a href=https://github.com/matthiask/speckenv/blob/master/speckenv.py>The implementation follows the basics outlined above.</a><p>Of course it may be useful to bundle the conversion of <a href=https://en.wikipedia.org/wiki/Data_source_name>DSNs</a> to the configuration format Django expects, however I mostly use individual libraries such as <a href=https://pypi.org/project/dj-database-url/>dj-database-url</a> and <a href=https://pypi.org/project/dj-email-url/>dj-email-url</a> for this.</div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Using environment variables to configure Django">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2020-09-13 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>