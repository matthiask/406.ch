<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>The insides of my static site generator - Matthias Kestenholz</title><link href=/styles.05fc032d0ad9.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=title href=/>Hi, I'm Matthias</a><p class=subtitle>I am a founding partner of <a href=https://feinheit.ch>Feinheit AG</a> and <a href=https://diebruchpiloten.com>Die Bruchpiloten AG</a>. Find me on <a href=https://github.com/matthiask/>GitHub</a>, <a href=https://hachyderm.io/@matthiask rel=me>Mastodon</a>, <a href=https://bsky.app/profile/matthiask.406.ch rel=me>Bluesky</a>, <a rel="noopener noreferrer"title="if you must"href=https://www.linkedin.com/in/matthiaskestenholz target=_blank>LinkedIn</a> or by <a href=mailto:mk@406.ch>email</a>.<nav><a href=/writing/category-climate/>Climate</a><a href=/writing/category-django/>Django</a><a href=/writing/category-feincms/>feincms</a><a href=/writing/category-feincms3/>feincms3</a><a href=/writing/category-politik/>Politik</a><a href=/writing/category-programming/>Programming</a><a href=/writing/category-python/>Python</a><a href=/writing/category-til/>TIL</a><a href=/writing/category-weeknotes/>Weeknotes</a></nav></div></header><main><div class=wrappy><div class=text><small>2023-04-19 </small><h1 id=the-insides-of-my-static-site-generator><a class=toclink href=#the-insides-of-my-static-site-generator>The insides of my static site generator</a></h1><p><a href=https://406.ch/writing/static-site-generation/>Last sunday I wrote that I’m now using a hacky ~200 LOC Python script to generate this blog.</a> The ~200 LOC became a challenge to myself immediately and I started refactoring the code while adding additional features, adding a licensing comment at the top and further reducing the lines of code in there.<p>I don’t intend to stop working on it, but I’m really happy with the result <a href=https://github.com/matthiask/406.ch/blob/e6402d0927c92c6d426db1dd44de6002940f28b7/generate.py>as it is currently</a>. The script is less than 190 lines long and supports:<ul><li>Generating individual HTML files for the front page, the category pages and posts<li>Generating <code>robots.txt</code> and <code>sitemap.xml</code><li>Generating Atom feeds for all posts and posts of each category<li>Minifying HTML and CSS using <a href=https://pypi.org/project/minify-html/>minify-html</a> and <a href=https://pypi.org/project/rcssmin/>rcssmin</a>; the CSS is outputted as a single file and includes the content hash in the filename for better cacheability<li>Keeping the link structure of the old Django-based website</ul><p>I used Django’s <code>feedgenerator.py</code> module at first to generate the Atom feed; I have since switched to directly working with the <a href=https://docs.python.org/3/library/xml.etree.elementtree.html#module-xml.etree.ElementTree>ElementTree API</a>. Yes, it’s probably less efficient since it has to keep the whole XML tree in memory but who cares when the largest file’s file size is under 100 KiB at the time of writing.<p>I’m using tox to generate the site locally; the local build includes published and draft posts. The production build uses GitHub actions and automatically deploys to GitHub pages, while only including published posts. There is no incremental build right now but rebuilding the whole site using tox (with an initialized virtualenv) takes less than one second, so that’s not really a pain point for me right now.<p>A difficulty was that I have used URLs ending in slashes in the past, not just for the browsable pages but also for the Atom feeds themselves. nginx only serves <code>index.html</code> in folders by default so I couldn’t just add a <code>index.xml</code> file in those folders. Luckily enough the internet is made of lots and lots of duct tape and saving the atom feed as <code>.../feed/index.html</code> actually works. It seems that RSS readers, aggregators and some libraries such as <a href=https://pypi.org/project/feedparser/>feedparser</a> do not really need the correct HTTP headers.<p>I have licensed the script under the <a href=http://www.wtfpl.net/>WTFPL</a>, so if you’re interested you can do what you want with it, without any obligations. I would certainly enjoy hearing about it though!</div><div class="text prevnext"><a href=/writing/weeknotes-2023-week-16/>Previous post</a><a href=/writing/weeknotes-2023-week-15/>Next post</a></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=The insides of my static site generator">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2023-04-19 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-dark></script></div></footer>