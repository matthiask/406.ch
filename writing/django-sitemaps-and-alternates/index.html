<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Django, Sitemaps and alternates - Matthias Kestenholz</title><link href=/styles.5cc4ab8bfdc5.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><small>2018-04-11 </small><h1>Django, Sitemaps and alternates</h1><p>Django’s own <a href=https://docs.djangoproject.com/en/2.0/ref/contrib/sitemaps/>sitemaps</a> module is great for quickly generating <a href=https://support.google.com/webmasters/answer/183668?hl=en>sitemaps</a>, but it unfortunately does not support more than the bare minimum of attributes. Also, it uses the template engine to create XML and this makes me sad.<p><a href=https://feinheit.ch/>We</a> had to add a <code>sitemap.xml</code> file to a customers’ website. The site supports several languages and runs on several domains, so we had to carefully specify <a href=https://support.google.com/webmasters/answer/2620865?hl=en>alternate language pages</a> and <a href=https://support.google.com/webmasters/answer/139066?hl=en>canonical URLs</a> so that the website would not be punished for duplicate content.<p>Therefore, a year ago I set out to build a sitemaps app for Django which supports Django’s sitemaps, but also allows adding entries with additional attributes. The result of this work was <a href=https://github.com/matthiask/django-sitemaps>django-sitemaps</a>.<div class=codehilite><pre><span></span><code><span class=kn>from</span> <span class=nn>django_sitemaps</span> <span class=kn>import</span> <span class=n>Sitemap</span>

<span class=k>def</span> <span class=nf>sitemap</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=n>sitemap</span> <span class=o>=</span> <span class=n>Sitemap</span><span class=p>(</span><span class=n>build_absolute_uri</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>build_absolute_uri</span><span class=p>)</span>
    <span class=n>sitemap</span><span class=o>.</span><span class=n>add_django_sitemap</span><span class=p>(</span><span class=n>SomeSitemap</span><span class=p>,</span> <span class=n>request</span><span class=o>=</span><span class=n>request</span><span class=p>)</span>
    <span class=n>sitemap</span><span class=o>.</span><span class=n>add</span><span class=p>(</span>
       <span class=n>url</span><span class=p>,</span>
       <span class=n>changefreq</span><span class=o>=</span><span class=s1>'weekly'</span><span class=p>,</span>
       <span class=n>priority</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
       <span class=n>lastmod</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
       <span class=n>alternates</span><span class=o>=</span><span class=p>{</span>
           <span class=s1>'en'</span><span class=p>:</span> <span class=s1>'...'</span><span class=p>,</span>
           <span class=s1>'en-ch'</span><span class=p>:</span> <span class=s1>'...'</span><span class=p>,</span>
           <span class=s1>'en-gb'</span><span class=p>:</span> <span class=s1>'...'</span><span class=p>,</span>
           <span class=s1>'de'</span><span class=p>:</span> <span class=s1>'...'</span><span class=p>,</span>
           <span class=o>...</span>
       <span class=p>},</span>
   <span class=p>)</span>
   <span class=k>return</span> <span class=n>sitemap</span><span class=o>.</span><span class=n>response</span><span class=p>(</span><span class=n>pretty_print</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div><p>Today, I also added support for generating the most simple <code>robots.txt</code> files possible: All user agents, and only <code>Sitemap: &LTabsolute url></code> entries. The recommended usage is now (still using <code>url()</code> instead of <code>path()</code> because I’m old and rusty):<div class=codehilite><pre><span></span><code><span class=kn>from</span> <span class=nn>django_sitemaps</span> <span class=kn>import</span> <span class=n>robots_txt</span>
<span class=kn>from</span> <span class=nn>app.views</span> <span class=kn>import</span> <span class=n>sitemap</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>url</span><span class=p>(</span><span class=sa>r</span><span class=s1>'^sitemap\.xml$'</span><span class=p>,</span> <span class=n>sitemap</span><span class=p>),</span>
    <span class=n>url</span><span class=p>(</span><span class=sa>r</span><span class=s1>'^robots\.txt$'</span><span class=p>,</span> <span class=n>robots_txt</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>86400</span><span class=p>)),</span>
    <span class=o>...</span>
<span class=p>]</span>
</code></pre></div></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Django, Sitemaps and alternates">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2018-04-11 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>