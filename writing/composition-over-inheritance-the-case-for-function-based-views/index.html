<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Composition over inheritance: The case for function-based views - Matthias Kestenholz</title><link href=/styles.485a2bd70464.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><h1 class=title>Hi, I'm Matthias</h1><p class=subtitle>I am a founding partner of <a href=https://feinheit.ch>Feinheit AG</a> and <a href=https://diebruchpiloten.com>Die Bruchpiloten AG</a>. Find me on <a href=https://github.com/matthiask/>GitHub</a>, <a href=https://hachyderm.io/@matthiask rel=me>Mastodon</a>, <a rel="noopener noreferrer"title="if you must"href=https://www.linkedin.com/in/matthiaskestenholz target=_blank>LinkedIn</a> or by <a href=mailto:mk@406.ch>email</a>.<nav><a href=/>Archive</a><a href=/writing/category-climate/>Climate</a><a href=/writing/category-django/>Django</a><a href=/writing/category-feincms/>feincms</a><a href=/writing/category-politik/>Politik</a><a href=/writing/category-programming/>Programming</a><a href=/writing/category-python/>Python</a><a href=/writing/category-weeknotes/>Weeknotes</a></nav></div></header><main><div class=wrappy><div class=text><small>2023-08-11 </small><h1>Composition over inheritance: The case for function-based views</h1><p><a href=https://hachyderm.io/@matthiask/110814846128940975>A recent conversation with Carlton on Mastodon</a> prompted me to write down some of my thoughts re. function- vs class-based views in Django.<h2>The early days</h2><p>When I started using Django some time after 0.96 and 1.0 all views were function based. Except when you added a class with a <code>def __call__()</code> method yourself – that was always possible but not really comparable to today’s class-based views.<h2>The introduction of class-based views</h2><p>Class based views (both generic versions and the base <code>View</code>) were introduced to Django in 2010. Judging from the <a href=https://code.djangoproject.com/ticket/6735>ticket tracker</a> the main motivation was to avoid adding yet another argument to the generic function-based views (GFBV) which were available in Django back then.<p>The GFBV’s argument count was impressive. Two examples follow:<div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>object_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>queryset</span><span class=p>,</span> <span class=n>object_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>slug</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>slug_field</span><span class=o>=</span><span class=s1>'slug'</span><span class=p>,</span> <span class=n>template_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>template_name_field</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>template_loader</span><span class=o>=</span><span class=n>loader</span><span class=p>,</span> <span class=n>extra_context</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>context_processors</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>template_object_name</span><span class=o>=</span><span class=s1>'object'</span><span class=p>,</span>
    <span class=n>mimetype</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=o>...</span>

<span class=k>def</span> <span class=nf>archive_month</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>month</span><span class=p>,</span> <span class=n>queryset</span><span class=p>,</span> <span class=n>date_field</span><span class=p>,</span>
    <span class=n>month_format</span><span class=o>=</span><span class=s1>'%b'</span><span class=p>,</span> <span class=n>template_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>template_loader</span><span class=o>=</span><span class=n>loader</span><span class=p>,</span>
    <span class=n>extra_context</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>context_processors</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>template_object_name</span><span class=o>=</span><span class=s1>'object'</span><span class=p>,</span> <span class=n>mimetype</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>allow_future</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
    <span class=o>...</span>
</code></pre></div><p>The GFBVs were immediately deprecated when GCBVs were introduced and later removed in 2012.<p>Class-based views have to be adapted by calling the <code>View.as_view()</code> method; <code>as_view()</code> returns arguably the thing which is viewed (sorry) as the view by Django, it’s the thing which gets called with a request and is expected to return a response. This thing in turn instantiates the view object once per request; this means that <code>self</code> can be used to save request-specific data such as <code>self.request</code>, <code>self.args</code> but also custom attributes.<p>The GCBV code is extremely factored and decomposed. The <a href=https://ccbv.co,ul/>Classy Class-Based Views</a> site mentions that the <code>UpdateView</code> has 10 separate ancestors and its code is spread across three files. But, the view code for instantiating a model object and handling a form really isn’t that complex. Most of the complexity is handled by Django itself, in the request handler and in the <code>django.forms</code> package. So, what’s the reason for all this?<h2>Generic views could be simple</h2><p>I wish that the existing generic views had better building blocks instead of a big hierarchy of mixins and multiple inheritance which is probably not understood by anyone without checking and re-checking the documentation, the code, or the excellent <a href=https://ccbv.co.uk/>Classy Class-Based Views</a>. Certainly not by me.<p>In my ideal world, generic views would be composed of small reusable and composable functions which wuld cover 80% of use cases with 20% of the code. And if not, you could copy the whole code of the view, change or introduce a line or two and leave it at that. And since the functions do one thing (but do that well) you can immediately see what they are doing and why. You’d avoid the Hollywood Principle (Don’t call us, we’ll call you) in your code. Sure, your view is called by Django but you don’t have to introduce more and more layers of indirection.<p>The internet is full of advice that you should prefer composition over inheritance. Let’s try to outline what generic views could look like if they followed the composition paradigm. Note that the goal isn’t to gain points by showing that the resulting code is shorter. One important goal is maintainability by being easier to understand. Another important goal is showing a better path from a beginner’s use of views to an experts understanding of everything underneath it by bridging the gap using more powerful building blocks which don’t leave all the minutiae to you if the defaults don’t work.<p>Some repetition caused by copy pasting is fine. Not all identical three lines of code are the same. The <a href=https://wiki.c2.com/?ThreeStrikesAndYouRefactor>Three Strikes And You Refactor</a> rule<sup id=fnref:wet><a class=footnote-ref href=#fn:wet>1</a></sup> leads to better and more maintainable code than following an extreme interpretation of the DRY (Don’t Repeat Yourself) principle.<h3>ListView and DetailView</h3><p>I’m going to profit from Django’s shortcuts module and also from <a href=https://feincms3.readthedocs.io/en/latest/ref/shortcuts.html>feincms3’s shortcuts module</a> which offers functions for rendering pages for single objects or lists of objects. The <code>render_list</code> and <code>render_detail</code> functions implement the same way of determining the template paths as the generic views use (for example <code>&LTapp_name>/&LTmodel_name>_detail.html</code>) and the same way of naming context variables (<code>object</code> and <code>&LTmodel_name></code> for the object, <code>object_list</code> and <code>&LTmodel_name>_list</code> for the list) as well as pagination but nothing more.<p>Here’s a possible minimal implementation of a list and detail object generic view:<div class=chl><pre><span></span><code><span class=c1># _get_queryset runs ._default_manager.all() on models and returns</span>
<span class=c1># everything else as-is. It's the secret sauce which allows using models,</span>
<span class=c1># managers or querysets with get_object_or_404 and friends.</span>
<span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>get_object_or_404</span><span class=p>,</span> <span class=n>_get_queryset</span>
<span class=kn>from</span> <span class=nn>feincms3.shortcuts</span> <span class=kn>import</span> <span class=n>render_list</span><span class=p>,</span> <span class=n>render_detail</span>

<span class=k>def</span> <span class=nf>object_list</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>paginate_by</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>render_list</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>_get_queryset</span><span class=p>(</span><span class=n>model</span><span class=p>),</span> <span class=n>paginate_by</span><span class=o>=</span><span class=n>paginate_by</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>object_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>slug</span><span class=p>,</span> <span class=n>slug_field</span><span class=o>=</span><span class=s2>"slug"</span><span class=p>):</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=o>**</span><span class=p>{</span><span class=n>slug_field</span><span class=p>:</span> <span class=n>slug</span><span class=p>})</span>
    <span class=k>return</span> <span class=n>render_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>
</code></pre></div><p>You want to change the way a single object is retrieved? You could do that easily but not by adding configuration-adjacent values in your URLconf but rather by adding a view yourself:<div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>article_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>slug</span><span class=p>):</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>Article</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>published</span><span class=p>(),</span> <span class=n>year</span><span class=o>=</span><span class=n>year</span><span class=p>,</span> <span class=n>slug</span><span class=o>=</span><span class=n>slug</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>render_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=n>path</span><span class=p>(</span><span class=s2>"articles/&LTyear:int>/&LTslug:slug>/"</span><span class=p>,</span> <span class=n>article_detail</span><span class=p>,</span> <span class=n>name</span><span class=o>=...</span><span class=p>),</span>
    <span class=o>...</span>
<span class=p>]</span>
</code></pre></div><p>I don’t think that was much harder than a hypothetical alternative:<div class=chl><pre><span></span><code><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=n>path</span><span class=p>(</span>
        <span class=s2>"articles/&LTyear:int>/&LTslug:slug>/"</span><span class=p>,</span>
        <span class=n>object_detail</span><span class=p>,</span>
        <span class=p>{</span>
            <span class=s2>"model"</span><span class=p>:</span> <span class=n>Article</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>published</span><span class=p>(),</span>
            <span class=s2>"object_kwargs"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"year"</span><span class=p>,</span> <span class=s2>"slug"</span><span class=p>],</span>
        <span class=p>},</span>
    <span class=p>),</span>
    <span class=o>...</span>
<span class=p>]</span>
</code></pre></div><p>And think about the internal implementation of the <code>object_detail</code> view. Viewed one additional feature at a time it may be fine but when adding up everything it would probably be quite gross.<p>The additional benefit is that it shows beginners the way to intermediate skills – writing views isn’t hard, and shouldn’t be.<p>Finally, the official way of overriding <code>DetailView.get_object()</code> (I think!) doesn’t look that good compared to the <code>def article_detail()</code> view above:<div class=chl><pre><span></span><code><span class=k>class</span> <span class=nc>ArticleDetailView</span><span class=p>(</span><span class=n>generic</span><span class=o>.</span><span class=n>DetailView</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>get_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>queryset</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>queryset</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>queryset</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_queryset</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>queryset</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>kwargs</span><span class=p>[</span><span class=s2>"year"</span><span class=p>],</span> <span class=n>slug</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>kwargs</span><span class=p>[</span><span class=s2>"slug"</span><span class=p>])</span>
</code></pre></div><p>Did you know that <code>get_object()</code> has an optional queryset argument? I certainly didn’t. It seems to be used by the date-based generic views but they also have their own <code>get_object()</code> implementation so who knows, really.<h2>Detail view with additional behavior</h2><div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>article_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>slug</span><span class=p>):</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>Article</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>published</span><span class=p>(),</span> <span class=n>year</span><span class=o>=</span><span class=n>year</span><span class=p>,</span> <span class=n>slug</span><span class=o>=</span><span class=n>slug</span><span class=p>)</span>
    <span class=n>data</span> <span class=o>=</span> <span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>FILES</span><span class=p>)</span> <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s2>"POST"</span> <span class=k>else</span> <span class=p>()</span>
    <span class=n>form</span> <span class=o>=</span> <span class=n>CommentForm</span><span class=p>(</span><span class=o>*</span><span class=n>data</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>form</span><span class=o>.</span><span class=n>is_valid</span><span class=p>():</span>
        <span class=n>form</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>article</span> <span class=o>=</span> <span class=nb>object</span>
        <span class=n>form</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>HttpResponseRedirect</span><span class=p>(</span><span class=s2>".#comments"</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>render_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=nb>object</span><span class=p>,</span> <span class=p>{</span><span class=s2>"comment_form"</span><span class=p>:</span> <span class=n>form</span><span class=p>})</span>
</code></pre></div><p>A counterexample would be to move the endpoint which accepts a comment POST request somewhere else. But then you’d also have to keep the different <code>CommentForm</code> instantiations in sync.<p>You could also override <code>get_context_data()</code> to add the comment form to the context and override <code>post()</code> to instantiate check the form’s validity. But then you’d have to make sure that an eventual invalid form is handled correctly by <code>get_context_data()</code>. It’s not hard but it certainly isn’t as straightforward as the example above either.<p>The custom view is the most obvious way of keeping the form instantiation in one place.<h2>Form views</h2><p>Generic create and update views could look something like this, again reusing the shortcuts mentioned above:<div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>save_and_redirect_to_object</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>):</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>form</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=nb>object</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>get_form_instance</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>form_class</span><span class=p>,</span> <span class=n>instance</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>model</span> <span class=ow>or</span> <span class=n>form_class</span><span class=p>,</span> <span class=s2>"Provide at least one of model and form_class"</span>
    <span class=k>if</span> <span class=n>form_class</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>form_class</span> <span class=o>=</span> <span class=n>modelform_factory</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
    <span class=n>data</span> <span class=o>=</span> <span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>FILES</span><span class=p>)</span> <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s2>"POST"</span> <span class=k>else</span> <span class=p>()</span>
    <span class=k>return</span> <span class=n>form_class</span><span class=p>(</span><span class=o>*</span><span class=n>data</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>object_create</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>form_class</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>form_valid</span><span class=o>=</span><span class=n>save_and_redirect_to_object</span><span class=p>):</span>
    <span class=n>form</span> <span class=o>=</span> <span class=n>get_form_instance</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span> <span class=n>form_class</span><span class=o>=</span><span class=n>form_class</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>form</span><span class=o>.</span><span class=n>is_valid</span><span class=p>():</span>
        <span class=k>return</span> <span class=n>form_valid</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>render_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=o>.</span><span class=n>instance</span><span class=p>,</span> <span class=p>{</span><span class=s2>"form"</span><span class=p>:</span> <span class=n>form</span><span class=p>},</span> <span class=n>template_name_suffix</span><span class=o>=</span><span class=s2>"_form"</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>object_update</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>slug</span><span class=p>,</span> <span class=n>slug_field</span><span class=o>=</span><span class=s2>"slug"</span><span class=p>,</span> <span class=n>form_class</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>form_valid</span><span class=o>=</span><span class=n>save_and_redirect_to_object</span><span class=p>):</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>get_object_or_404</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=o>**</span><span class=p>{</span><span class=n>slug_field</span><span class=p>:</span> <span class=n>slug</span><span class=p>})</span>
    <span class=n>form</span> <span class=o>=</span> <span class=n>get_form_instance</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=nb>object</span><span class=o>.</span><span class=vm>__class__</span><span class=p>,</span> <span class=n>form_class</span><span class=o>=</span><span class=n>form_class</span><span class=p>,</span> <span class=n>instance</span><span class=o>=</span><span class=nb>object</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>form</span><span class=o>.</span><span class=n>is_valid</span><span class=p>():</span>
        <span class=k>return</span> <span class=n>form_valid</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>render_detail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=o>.</span><span class=n>instance</span><span class=p>,</span> <span class=p>{</span><span class=s2>"form"</span><span class=p>:</span> <span class=n>form</span><span class=p>},</span> <span class=n>template_name_suffix</span><span class=o>=</span><span class=s2>"_form"</span><span class=p>)</span>
</code></pre></div><p>You want to redirect to a different URL and maybe emit a success message? Easy:<div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>article_form_valid</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>):</span>
    <span class=n>form</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
    <span class=n>messages</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>_</span><span class=p>(</span><span class=s2>"Successfully updated the article."</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s2>"articles:list"</span><span class=p>)</span>

<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=o>...</span>
    <span class=n>path</span><span class=p>(</span>
        <span class=s2>"&LTslug:slug>/update/"</span><span class=p>,</span>
        <span class=n>object_update</span><span class=p>,</span>
        <span class=p>{</span><span class=s2>"model"</span><span class=p>:</span> <span class=n>Article</span><span class=p>,</span> <span class=s2>"form_valid"</span><span class=p>:</span> <span class=n>article_form_valid</span><span class=p>},</span>
        <span class=n>name</span><span class=o>=...</span>
    <span class=p>),</span>
    <span class=o>...</span>
<span class=p>]</span>
</code></pre></div><p>Yes, these generic views wouldn’t allow overriding the case when a form was invalid. But, I’d assume that displaying the form with error messages is the right thing to do in 90% of the cases. And if not, write your own specific or generic view? After all, with the mentioned tools it won’t take up more than a few lines of straightforward code. (If the code was tricky it would be different. But views shouldn’t be tricky.)<p>Adding more <code>form_valid</code> handlers should be mostly painless. A few examples inspired by <a href=https://docs.djangoproject.com/en/4.2/topics/class-based-views/generic-editing/>Django’s generic editing documentation</a>:<div class=chl><pre><span></span><code><span class=k>def</span> <span class=nf>save_and_redirect_to</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>fn</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>):</span>
        <span class=n>form</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>fn</span>

<span class=k>def</span> <span class=nf>send_mail</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>):</span>
    <span class=n>form</span><span class=o>.</span><span class=n>send_email</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>HttpResponseRedirect</span><span class=p>(</span><span class=s2>"/thanks/"</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>set_author_and_save</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>form</span><span class=p>):</span>
    <span class=n>form</span><span class=o>.</span><span class=n>instance</span><span class=o>.</span><span class=n>created_by</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>user</span>
    <span class=nb>object</span> <span class=o>=</span> <span class=n>form</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=nb>object</span><span class=p>)</span>
</code></pre></div><p>You could also couple the form a bit to the request and do something like:<div class=chl><pre><span></span><code>def process_form(request, form):
    return form.process(request)
</code></pre></div><p>Sure, forms probably shouldn’t know much about requests. But then, Django is a framework for perfectionists <em>with deadlines</em> and sometimes practicality beats purity.<h2>Date-based generic views</h2><p>I think I would want to offer a few analyzers which allow easily returning a data structure suitable for rendering links for yearly, monthly, weekly or even daily (who writes that much?) archives. The <a href=https://docs.djangoproject.com/en/4.2/ref/models/querysets/#dates><code>.dates()</code> queryset method</a> method should be a big help there.<p>The archive views themselves are straightforward adaptations of the <code>object_list</code> view above.<p>It may feel like leaving out the actually hard part but I’d have to be convinced that this is actually a hard problem and not just a problem of making basically arbitrary choices which people then adapt to and then think that this is the way things should be since it’s the way things are.<h2>Wrapping up</h2><p>Some points this post could have made or tried to make are made much better by Luke Plant in the guide <a href=https://spookylukey.github.io/django-views-the-right-way/>Django Views - The Right Way</a>. I don’t generally think that class-based views never make sense. I also don’t think that people shouldn’t use the available tools. I just think that I, myself, don’t want to use them, and I also think that I’m still happier with <code>lambda
request: HttpResponseRedirect(...)</code> than with <code>generic.RedirectView.as_view(url=...)</code>. The point isn’t to compare the character count. The point is: Does the <code>RedirectView</code> cause a permanent or a temporary redirect? I had to look it up for a long time, and then it changed. The former is completely obvious.<h2>Closing words</h2><p>I know that people have strong opinions. I’m not interested in all of them. I’m mostly interested in design critiques and arguments regarding the beginner to intermediate skills argument. It’s fine if CBVs work fine for you, and there’s no need to feel challenged by this post.<p>Thanks for reading!<div class=footnote><hr><ol><li id=fn:wet><p>Also called the WET rule (Write Everything Twice). (Not coined by me.) <a title="Jump back to footnote 1 in the text"class=footnote-backref href=#fnref:wet>↩</a></p></ol></div></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Composition over inheritance: The case for function-based views">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2023-08-11 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a>, <a href=/writing/category-python/>Python</a>, <a href=/writing/category-feincms/>feincms</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>