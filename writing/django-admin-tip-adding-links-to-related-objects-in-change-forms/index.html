<!doctype html><html lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>Django admin tip: Adding links to related objects in change forms - Matthias Kestenholz</title><link href=/styles.6cf33c7d4923.css rel=stylesheet><link title="Blog feed" href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=title href=https://406.ch/>Hi, I'm Matthias</a><p class=subtitle>I am a founding partner of <a href=https://feinheit.ch>Feinheit AG</a> and <a href=https://diebruchpiloten.com>Die Bruchpiloten AG</a>. Find me on <a href=https://github.com/matthiask/>GitHub</a>, <a href=https://hachyderm.io/@matthiask rel=me>Mastodon</a>, <a href=https://bsky.app/profile/matthiask.406.ch rel=me>Bluesky</a>, <a rel="noopener noreferrer" title="if you must" href=https://www.linkedin.com/in/matthiaskestenholz target=_blank>LinkedIn</a> or by <a href=mailto:mk@406.ch>email</a>.<nav><a href=https://406.ch/writing/category-climate/>Climate</a><a href=https://406.ch/writing/category-django/>Django</a><a href=https://406.ch/writing/category-feincms/>feincms</a><a href=https://406.ch/writing/category-politik/>Politik</a><a href=https://406.ch/writing/category-programming/>Programming</a><a href=https://406.ch/writing/category-python/>Python</a><a href=https://406.ch/writing/category-til/>TIL</a><a href=https://406.ch/writing/category-weeknotes/>Weeknotes</a></nav></div></header><main><div class=wrappy><div class=text><small>2025-01-17 </small><h1 id=django-admin-tip-adding-links-to-related-objects-in-change-forms><a class=toclink href=#django-admin-tip-adding-links-to-related-objects-in-change-forms>Django admin tip: Adding links to related objects in change forms</a></h1><p>Any issue which came up on the Django Forum and Discord is how to add links to other objects to the Django administration interface. It’s something I’m doing often and I want to share the pattern I’m using.<p>It’s definitely not rocket science and there are probably better ways to do it, but this one works well for me.<h2 id=method-1-override-the-change-form-template><a class=toclink href=#method-1-override-the-change-form-template>Method 1: Override the change form template</a></h2><p>In one project users can be the editor of exactly one organization. The link between organizations and users is achieved using a <code>Editor</code> model with a <code>ForeignKey(Organization)</code> and a <code>OneToOneField(User)</code>.<p>I wanted to add a link to the organization page at the bottom of the user form. An easy way to achieve this is to add a template at <code>templates/admin/auth/user/change_form.html</code> (or something similar if you’re using a custom user model):<div class=chl><pre><span></span><code><span class=cp>{%</span> <span class=k>extends</span> <span class=s2>"admin/change_form.html"</span> <span class=cp>%}</span>

<span class=cp>{%</span> <span class=k>block</span> <span class=nv>after_related_objects</span> <span class=cp>%}</span>
<span class=cp>{{</span> <span class=nb>block</span><span class=nv>.super</span> <span class=cp>}}</span>

<span class=cp>{%</span> <span class=k>if</span> <span class=nv>original.editor</span> <span class=cp>%}</span>
<span class=p>&lt;</span><span class=nt>fieldset</span> <span class=na>class</span><span class=o>=</span><span class=s>"module aligned"</span><span class=p>></span>
<span class=p>&lt;</span><span class=nt>h2</span><span class=p>></span>Organization<span class=p>&lt;/</span><span class=nt>h2</span><span class=p>></span>
<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>"form-row"</span><span class=p>></span>
  <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>"</span><span class=cp>{%</span> <span class=k>url</span> <span class=s1>'admin:organizations_organization_change'</span> <span class=nv>original.editor.organization.pk</span> <span class=cp>%}</span><span class=s>"</span><span class=p>></span><span class=cp>{{</span> <span class=nv>original.editor.organization</span> <span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>></span>
<span class=p>&lt;/</span><span class=nt>div</span><span class=p>></span>
<span class=p>&lt;/</span><span class=nt>fieldset</span><span class=p>></span>
<span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>

<span class=cp>{%</span> <span class=k>endblock</span> <span class=nv>after_related_objects</span> <span class=cp>%}</span>
</code></pre></div><p>The <code>original</code> context variable contains the object being edited. The <code>editor</code> attribute is the reverse accessor for the <code>OneToOneField</code> mentioned above.<h2 id=method-2-add-a-method-to-the-model-admin-class-returning-a-html-blob><a class=toclink href=#method-2-add-a-method-to-the-model-admin-class-returning-a-html-blob>Method 2: Add a method to the model admin class returning a HTML blob</a></h2><p>A terrible but also nice way is to add a method to the <code>ModelAdmin</code> class which returns the HTML containing the links you want, and adding the name of the method to <code>readonly_fields</code>. This is even mentioned in <a href=https://docs.djangoproject.com/en/stable/ref/contrib/admin/#django.contrib.admin.ModelAdmin.readonly_fields>the official <code>readonly_fields</code> documentation</a> but I discovered this by accident a few years back.<p>The method name doesn’t have to be added anywhere else, not to <code>fields</code> nor do you have to define <code>fieldsets</code> for this to work. Just adding it to <code>readonly_fields</code> appends it to the end of the form, before any eventual inlines you’re using.<div class=chl><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>django.template.loader</span><span class=w> </span><span class=kn>import</span> <span class=n>render_to_string</span>
<span class=kn>from</span><span class=w> </span><span class=nn>app</span><span class=w> </span><span class=kn>import</span> <span class=n>models</span>

<span class=nd>@admin</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Class</span><span class=p>)</span>
<span class=k>class</span><span class=w> </span><span class=nc>ClassAdmin</span><span class=p>(</span><span class=n>admin</span><span class=o>.</span><span class=n>ModelAdmin</span><span class=p>):</span>
    <span class=n>list_display</span> <span class=o>=</span> <span class=p>[</span><span class=s2>"name"</span><span class=p>,</span> <span class=s2>"language_code"</span><span class=p>]</span>
    <span class=n>readonly_fields</span> <span class=o>=</span> <span class=p>[</span><span class=s2>"admin_show_custom_districts"</span><span class=p>]</span>

    <span class=nd>@admin</span><span class=o>.</span><span class=n>display</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=n>_</span><span class=p>(</span><span class=s2>"districts"</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>admin_show_custom_districts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>render_to_string</span><span class=p>(</span>
            <span class=s2>"admin/admin_show_custom_districts.html"</span><span class=p>,</span>
            <span class=p>{</span><span class=s2>"custom_districts"</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>customdistrict_set</span><span class=o>.</span><span class=n>all</span><span class=p>()},</span>
        <span class=p>)</span>
</code></pre></div></div><div class="text prevnext"><a href=https://406.ch/writing/weeknotes-2025-week-05/>Newer post</a><a href=https://406.ch/writing/weeknotes-2025-week-03/>Older post</a></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=Django admin tip: Adding links to related objects in change forms">Send me an email.</a> <br> <a rel="noopener noreferrer" href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2025-01-17 in <a href=https://406.ch/writing/category-django/>Django</a>, <a href=https://406.ch/writing/category-programming/>Programming</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-dark></script></div></footer>