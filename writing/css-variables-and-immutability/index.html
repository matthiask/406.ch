<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>CSS variables and immutability - Matthias Kestenholz</title><link href=/styles.ce861246a36a.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><small>2023-06-14 </small><h1>Using CSS variables<sup id=fnref:variables><a class=footnote-ref href=#fn:variables>1</a></sup> to ship customizable CSS in Django apps</h1><p>I have been working with <a href=https://sass-lang.com/>SASS</a> for a long time but have been moving towards writing CSS with a few <a href=https://postcss.org/>PostCSS</a> goodies in the last years. At first, I just replaced the <code>$...</code> with <code>var(--...)</code> and didn’t think much about it. The realization that CSS variables can be more than that came later. Edit basic values directly in the browser and immediately see the results! Change CSS depending on media queries or the cascade!<p>With all that power came back the wish to not just ship backend and HTML code in Django apps I (help) maintain but also reusable CSS, with a few overrideable CSS variables for basic changes to the visual style. Loading <code>.scss</code> files from somewhere inside <code>venv/lib/python3.11/site-packages/&LTpackage>/styles/</code> would of course have been possible, but very obscure. Also, not everyone puts their virtualenv at <code>venv</code>, the <code>README</code> instructions for those packages would quickly have become unwieldy. CSS variables paved the way for shipping CSS as a Django static file while still allowing customizability by leveraging the functionality of the browser itself instead of the frontend build toolchain.<h2>Patterns for overrideable values</h2><p>A pattern for defining defaults for CSS variables is to always define the fallback (the example is intentionally bad but inspired by real world experiences when developing <a href=https://github.com/feinheit/feincms3-cookiecontrol>feincms3-cookiecontrol</a>):<div class=codehilite><pre><span></span><code><span class=p>.</span><span class=nc>box</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-background</span><span class=p>,</span><span class=w> </span><span class=mh>#222</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>color</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-foreground</span><span class=p>,</span><span class=w> </span><span class=mh>#fff</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><h2>Less repetition (but trouble awaits)</h2><p>If <code>--box-background</code> isn’t set the <code>var()</code> function falls back to the second argument, <code>#222</code>. Repeating this value over and over gets annoying quickly, so you define a few defaults on the <code>:root</code> element and use those variables in the code, without specifying the default again:<div class=codehilite><pre><span></span><code><span class=p>:</span><span class=nd>root</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-background</span><span class=p>:</span><span class=w> </span><span class=mh>#222</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-foreground</span><span class=p>:</span><span class=w> </span><span class=mh>#fff</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=p>.</span><span class=nc>box</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-background</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>color</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-foreground</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>The project can now override the default background color using:<div class=codehilite><pre><span></span><code><span class=p>:</span><span class=nd>root</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-background</span><span class=p>:</span><span class=w> </span><span class=mh>#444</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-foreground</span><span class=p>:</span><span class=w> </span><span class=mh>#ccc</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>Of course now you’re back at the mercy of CSS loading order. If the app’s CSS is loaded first, everything works. If not, your custom value is immediately overwritten. You could avoid this by overwriting the default lower in the cascade:<div class=codehilite><pre><span></span><code><span class=p>.</span><span class=nc>box</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-background</span><span class=p>:</span><span class=w> </span><span class=mh>#444</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-foreground</span><span class=p>:</span><span class=w> </span><span class=mh>#ccc</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>Great, everything works again!<p>Later, the box also contains a button which uses a different background but the same foreground, so of course we add more variables in the package:<div class=codehilite><pre><span></span><code><span class=p>:</span><span class=nd>root</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-background</span><span class=p>:</span><span class=w> </span><span class=mh>#222</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-foreground</span><span class=p>:</span><span class=w> </span><span class=mh>#fff</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-button-background</span><span class=p>:</span><span class=w> </span><span class=mh>#333</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=nv>--box-button-foreground</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-foreground</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>What happens now when overwriting the <code>--box-foreground</code> variable just for the <code>.box</code> element?<p>You’re not sure? I certainly wasn’t and am not. But what I remember happening was that the overridden foreground color was just applied to the text and not to the button itself. I was confused (it seems clearer in hindsight…)<h2>A better way</h2><p>If values are supposed to be overridden and only used inside components, a better way is to define local CSS for components by following a convention (underscore prefix for local/private variables):<div class=codehilite><pre><span></span><code><span class=c>/* Defined on .box, not :root */</span><span class=w></span>
<span class=p>.</span><span class=nc>box</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nv>--_background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-background</span><span class=p>,</span><span class=w> </span><span class=mh>#222</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=nv>--_foreground</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-foreground</span><span class=p>,</span><span class=w> </span><span class=mh>#fff</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=nv>--_button-background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-button-background</span><span class=p>,</span><span class=w> </span><span class=mh>#333</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=nv>--_button-foreground</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--box-button-foreground</span><span class=p>,</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--_foreground</span><span class=p>));</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>And then you only use the prefixed versions inside the component:<div class=codehilite><pre><span></span><code><span class=p>.</span><span class=nc>box</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--_background</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>color</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--_foreground</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=p>.</span><span class=nc>box__button</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>background</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--_button-background</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>color</span><span class=p>:</span><span class=w> </span><span class=nf>var</span><span class=p>(</span><span class=nv>--_button-foreground</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div><p>The <code>--box-*</code> variables are undefined by default; the only time when they are set is when the user of the package wants to override those values. If you only overide the box foreground the button also inherits the new foreground color. And while there would certainly be a way to achieve the same thing with the old way above it’s certainly not as simple to explain.<p>The reason why it’s simple to explain is <strong>immutability</strong>. The CSS variables which are overrideable by the user are only ever read by the package, never written to.<div class=footnote><hr><ol><li id=fn:variables><p>Custom properties would probably be the more correct naming, but CSS variables is nicer to say. <a title="Jump back to footnote 1 in the text"class=footnote-backref href=#fnref:variables>↩</a></p></ol></div></div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=CSS variables and immutability">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2023-06-14 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a>, <a href=/writing/category-feincms/>feincms</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>