<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>How ruff changed my Python programming habits - Matthias Kestenholz</title><link href=/styles.f534a940f4b9.css rel=stylesheet><link title="Blog feed"href=/writing/atom.xml rel=alternate type=application/atom+xml><body><header><div class=wrappy><a class=back href=/>Back to the overview</a></div></header><main><div class=wrappy><div class=text><small>2023-07-26 </small><h1>How ruff changed my Python programming habits</h1><p><a href=https://beta.ruff.rs/>ruff</a> isn’t just a faster replacement for flake8, isort and friends.<p>With other Python-based formatters and linters there’s always a trade off between development speed (waiting on <code>git commit</code> is very boring) and strictness.<p>ruff is so fast that enabling additional rules is practically free in terms of speed; the only question is if those rules lead to better, or maybe just to more correct and consistent code.<p>I have long been using <a href=https://pre-commit.com/>pre-commit</a>, and even longer flake8, black, isort. I have written a piece about <a href=https://406.ch/writing/flake8-and-value-standards/>flake8 and the value of standards</a> almost 9 years ago and have continued moving in the mentioned direction ever since.<p>These days I have enabled a wide variety of rules. I’m not sold on all of them (looking at you, pylint) and I’m definitely not of the opinion that rules which I’m not using currently are worthless. I didn’t even know most of these rules before starting to use ruff, and ruff making them easy and painless to use (without a measureable performance penalty) has certainly lead to me annoying my coworkers with a growing set of enabled rules.<h2>Rules</h2><p>The current ruleset and some justifications for it follows.<h3>pyflakes, pycodestyle</h3><p>No justification necessary, really.<h3>mccabe</h3><p>I like the cyclomatic complexity checker, but I have relaxed it a bit. I find it very useful to avoid complex code, but some code is totally straightforward (e.g. building a queryset from a wide variety of query parameters) but still has many <code>if</code> statements. I’d rather allow more complexity instead of sprinkling the code with <code># noqa</code> statements.<h3>isort</h3><p>Sorted imports are great.<h3>pep8-naming</h3><p>Mostly great except when it flags Django’s migration files. The filenames always start with numbers and that’s obviously not a valid Python module name, but it’s not supposed to be.<h3>pyupgrade</h3><p>pyupgrade is totally awesome.<h3>flake-2020</h3><p>Avoiding non future-proof uses of <code>sys.version</code> and <code>sys.version_info</code> is a good idea, no questions about that.<h3>flake8-boolean-trap</h3><p>Sometimes annoying, mostly useful. I don’t like that the plugin flags e.g. <code>with_tree_fields(True)</code> or <code>with_tree_fields(False)</code> because I don’t think this could be possibly misread. But, apart from these edge cases it really is a good idea, especially since keyword-only arguments exist and those aren’t flagged by this rule.<h3>flake8-bugbear</h3><p>Mostly useful. I have disabled the <code>zip()</code> without <code>strict=</code> warning.<h3>flake8-comprehensions</h3><p>Checks for unnecessary conversions between generators and lists, sets, tuples or dicts.<h3>flake8-django</h3><p>I actually like consistency. I also like flagging <code>fields = "__all__"</code>, but this check shouldn’t trigger in admin <code>ModelForm</code> classes, really. I probably have to add another entry to <code>[tool.ruff.per-file-ignores]</code> for this.<h3>flake8-pie</h3><p>Quite a random assortment of rules. I like the <code>no-unnecessary-pass</code> and <code>no-pointless-statements</code> rules, among others.<h3>flake8-simplify</h3><p>Nice simplifications. I’m not sure if ternary opeartors are always a plus, especially since they hide the branching from <a href=https://pypi.org/project/coverage/>coverage</a>.<h3>flake8-gettext</h3><p>Enormously useful and important. I don’t know how many times I have encountered broken code like <code>gettext("Hello {name}".format(name=name))</code> instead of <code>gettext("Hello {name}").format(name=name)</code>.<h3>pygrep-hooks</h3><p>Avoids <code>eval()</code>. Avoids blanket <code># noqa</code> rules (always be specific!)<h3>pylint</h3><p>I have been using all pylint rules for some time. The pylint refactoring rules (<code>PLR</code>) did prove to be very annoying so I have reverted to only enabling errors and warnings.<p>The two main offenders were PLR0913 (too many arguments) and PLR2004 (magic value comparison). The former would be fine if it would count keyword-only arguments differently; it’s certainly a good idea to avoid too many positional parameters, I don’t think keyword-only parameters are that bad. The latter is bad because often the magic value is really obvious. If you’re writing code for the web you shouldn’t have to use constants for the <code>200</code> or <code>404</code> status codes; one can assume that they are well known.<h3>RUF100</h3><p>Ruff is able to automatically remove <code># noqa</code> statements which don’t actually silence any warnings. That’s a great feature to have.<h2>Line length</h2><p>Yes, let’s go there. I still don’t use longer lines than +/- 80 characters, but I have disabled all line length warnings these days. I don’t want to be warned because I didn’t break a string across lines.<h2>Rules I don’t like</h2><ul><li>flake8-builtins: Too many boring warnings. I didn’t even want to know that <code>copyright</code> is a Python builtin.<li>flake8-logging-format: Not generally helpful. Avoiding different exception strings so that e.g. <a href=https://sentry.io/welcome/>Sentry</a> can group exceptions more easily is a good idea, but the rule generated so many false positives as to be not useful anymore.</ul><h2>Final words (for now)</h2><p>I really hope that Black is integrated into ruff one day.<p>Also, I hope that ESLint and prettier will be replaced by a faster tool. I have my eyes on a few alternatives, but they are not there yet for my use cases.</div></div></main><footer><div class=wrappy><p><small> I like feedback! <a href="mailto:mk@406.ch?subject=How ruff changed my Python programming habits">Send me an email.</a> <br> <a rel="noopener noreferrer"href=https://ko-fi.com/matthiask target=_blank>☕ Buy me a coffee?</a> <br> Published on 2023-07-26 in <a href=/writing/category-django/>Django</a>, <a href=/writing/category-programming/>Programming</a>, <a href=/writing/category-python/>Python</a> </small></p><script async crossorigin issue-term=pathname repo=matthiask/406-comments src=https://utteranc.es/client.js theme=github-light></script></div></footer>